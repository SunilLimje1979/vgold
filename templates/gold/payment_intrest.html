{% load i18n %}
{% load static %}
{% load pwa %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  {% if request.session.source != "webview" %}
  <link rel="manifest" href="{% static 'assets/manifest.json' %}">
  {% endif %}
  <title>Complaint</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />

  <style>
    .navbar {
      background-color: rgb(41, 39, 122);
      height: 55px;
      color: white;
    }
    .navbar-brand, .fa-arrow-left {
      color: white;
    }
    .form-section {
      margin: 20px 0;
    }
    .form-control {
      border-radius: 14px;
      font-size: 18px;
    }
    .btn-custom {
      background-color: rgb(41, 39, 122);
      color: white;
      border-radius: 14px;
      font-size: 18px;
      padding: 10px 30px;
      width: 100%;
    }
    #resultDisplay {
      font-weight: bold;
      font-size: 20px;
      color: green;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <a href="{% url 'dashboard' %}" class="me-3"><i class="fa fa-arrow-left" aria-hidden="true"></i></a>
        <a class="navbar-brand mb-0 h1">Payment Intrest</a>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <form method="post">
      {% csrf_token %}

      <!-- Amount Input -->
      <div class="form-section">
        <input type="number" id="amountInput" class="form-control" placeholder="Enter Amount (₹)" required />
      </div>

      <!-- Type Dropdown -->
      <div class="form-section">
        <select id="typeSelect" class="form-select" required>
          <option value="">Select TYPE</option>
          <option value="Setup Charges">Setup Charges</option>
          <option value="Maintenance">Maintenance</option>
          <option value="Debit Card">Debit Card</option>
          <option value="UPI">UPI</option>
          <option value="BQR">BQR</option>
          <option value="Credit Card">Credit Card</option>
          <option value="Net Banking">Net Banking</option>
        </select>
      </div>

      <!-- Particular Dropdown -->
      <div class="form-section">
        <select id="particularSelect" class="form-select" disabled required>
          <option value="">Select Particular</option>
        </select>
      </div>

      <!-- Output -->
      <div id="resultDisplay"></div>

      <!-- Submit Button -->
      <div class="form-section">
        <button id="submitButton" type="submit" class="btn btn-custom">Submit</button>
      </div>
    </form>

    {% if messages %}
    <div class="row justify-content-center mt-3">
      {% for message in messages %}
      <div class="alert {% if message.tags == 'error' %}alert-danger{% elif message.tags == 'success' %}alert-success{% endif %} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>

  <script>
    const rateData = {
      "Setup Charges": {
        "One Time Integration Fees": 0
      },
      "Maintenance": {
        "Annual Maintenance Charges": 0
      },
      "Debit Card": {
        "Rupay Debit Cards": 0,
        "Domestic Debit < 2000": 0.40,
        "Domestic Debit > 2000": 0.90
      },
      "UPI": {
        "UPI - All PSP": 0,
        "UPI via Rupay Credit Card": 1.85
      },
      "BQR": {
        "BQR < 2000": 0.30,
        "BQR > 2000": 0.80
      },
      "Credit Card": {
        "Domestic Individual Credit Cards": 1.85,
        "Diners Card": 1.85,
        "Commercial Credit Cards (All Banks)": 2.50,
        "International Credit Cards": 2.75
      },
      "Net Banking": {
        "Net Banking": 30
      }
    };

    const typeSelect = document.getElementById("typeSelect");
    const particularSelect = document.getElementById("particularSelect");
    const amountInput = document.getElementById("amountInput");
    const resultDisplay = document.getElementById("resultDisplay");

    typeSelect.addEventListener("change", () => {
      const selectedType = typeSelect.value;
      particularSelect.innerHTML = '<option value="">Select Particular</option>';
      particularSelect.disabled = true;

      if (rateData[selectedType]) {
        Object.keys(rateData[selectedType]).forEach((key) => {
          const option = document.createElement("option");
          option.value = key;
          option.text = key;
          particularSelect.appendChild(option);
        });
        particularSelect.disabled = false;
      }

      resultDisplay.textContent = "";
    });

    particularSelect.addEventListener("change", updateResult);
    amountInput.addEventListener("input", updateResult);

    function updateResult() {
      const type = typeSelect.value;
      const particular = particularSelect.value;
      const amount = parseFloat(amountInput.value);

      if (!type || !particular || isNaN(amount)) {
        resultDisplay.textContent = "";
        return;
      }

      const rate = rateData[type][particular];
      let customerPays;

      if (type === "Net Banking") {
        customerPays = amount + rate;
      } else {
        customerPays = amount + (amount * rate / 100);
      }

      resultDisplay.textContent = `Customer Pays: ₹${Math.round(customerPays)}`;
    }

    // Auto close alerts
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".btn-close").forEach((button) => {
        button.addEventListener("click", function () {
          this.closest(".alert").remove();
        });
      });

      document.querySelectorAll(".alert").forEach((alert) => {
        setTimeout(() => alert.remove(), 5000);
      });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
